<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Music & Lyrics Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ffeb3b;
            --secondary: #000;
            --accent: #ff5722;
            --text-light: #f5f5f5;
            --text-dark: #333;
            --success: #4CAF50;
            --info: #2196F3;
            --warning: #FFC107;
            --danger: #F44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--primary);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        /* Navbar */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 235, 59, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-weight: bold;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Main content */
        main {
            padding: 120px 5% 80px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Generator sections */
        .generator-section {
            background-color: rgba(30, 30, 30, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 235, 59, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .generator-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .section-title {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 235, 59, 0.3);
            background-color: rgba(50, 50, 50, 0.7);
            color: var(--text-light);
            font-size: 1rem;
            transition: border 0.3s ease, box-shadow 0.3s ease;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 235, 59, 0.2);
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: var(--secondary);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 235, 59, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(255, 235, 59, 0.1);
            color: var(--primary);
            border: 1px solid rgba(255, 235, 59, 0.3);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 235, 59, 0.2);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: var(--text-dark);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        /* Results section */
        .result-container {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .result-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .lyrics-result {
            white-space: pre-wrap;
            background-color: rgba(40, 40, 40, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 235, 59, 0.2);
            margin-bottom: 20px;
            position: relative;
            line-height: 1.6;
        }
        
        .lyrics-line {
            margin-bottom: 8px;
        }
        
        .lyrics-section {
            margin-bottom: 20px;
        }
        
        .section-label {
            display: inline-block;
            background-color: rgba(255, 87, 34, 0.2);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .audio-player {
            width: 100%;
            margin-top: 20px;
            border-radius: 8px;
            background-color: rgba(40, 40, 40, 0.7);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        /* Status indicators */
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .status-processing {
            background-color: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.3);
            color: var(--text-light);
        }
        
        .status-success {
            background-color: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: var(--text-light);
        }
        
        .status-error {
            background-color: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: var(--text-light);
        }
        
        .progress-container {
            margin-top: 15px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 235, 59, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Glow effects */
        .glow {
            position: fixed;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.3;
            z-index: -1;
        }
        
        .glow-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: -150px;
            left: -150px;
        }
        
        .glow-2 {
            width: 400px;
            height: 400px;
            background: var(--accent);
            bottom: -200px;
            right: -200px;
        }
        
        /* New UI Elements */
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .ai-badge {
            background-color: rgba(255, 235, 59, 0.2);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px;
            cursor: pointer;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .slider-container {
            margin-top: 8px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            min-width: 30px;
            text-align: center;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .visualizer {
            width: 100%;
            height: 80px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .visualizer-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background-color: var(--primary);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        .tag {
            display: inline-block;
            background-color: rgba(255, 235, 59, 0.1);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 235, 59, 0.2);
        }
        
        .tag:hover {
            background-color: rgba(255, 235, 59, 0.2);
            transform: translateY(-2px);
        }
        
        .tag.active {
            background-color: var(--primary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .preset-btn {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
        }
        
        .presets-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            main {
                padding: 100px 5% 60px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Animation for generated content */
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-in {
            animation: slideUp 0.5s ease forwards;
        }
        
        /* Waveform visualizer */
        .waveform {
            width: 100%;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform-bar {
            position: absolute;
            bottom: 0;
            width: 3px;
            background-color: var(--primary);
            border-radius: 2px;
        }
        
        /* Theme toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .theme-icon {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    
    <!-- Navigation bar -->
    <nav>
        <div class="logo-container">
            <div class="logo-img">MG</div>
            <div class="logo-text">Music Generator</div>
        </div>
        <div class="theme-toggle" id="theme-toggle">
            <i class="fas fa-moon theme-icon"></i>
            <span>Dark</span>
        </div>
    </nav>
    
    <!-- Main content -->
    <main>
        <!-- Lyrics Generator Section -->
        <section class="generator-section">
            <h2 class="section-title"><i class="fas fa-align-left"></i>AI Lyrics Generator</h2>
            
            <form id="lyrics-generator-form">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="seed">Seed Text (optional)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Provide a few words or phrases to inspire the lyrics</span>
                                </span>
                            </label>
                            <input type="text" id="seed" name="seed" placeholder="e.g. 'summer nights, young love'">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="emotion">Emotion</label>
                            <select id="emotion" name="emotion">

                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="genre">Genre
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Select a music genre to influence the lyrical style</span>
                                </span>
                            </label>
                            <select id="genre" name="genre">
                                <option value="pop">Pop</option>
                                <option value="rock">Rock</option>
                                <option value="hiphop">Hip Hop</option>
                                <option value="rnb">R&B</option>
                                <option value="country">Country</option>
                                <option value="electronic">Electronic</option>
                                <option value="jazz">Jazz</option>
                                <option value="indie">Indie</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="structure">Song Structure
                                <span class="tooltip">
                                    <i class="fas fa-info-circle"></i>
                                    <span class="tooltiptext">Comma separated sections (verse, chorus, bridge, etc.)</span>
                                </span>
                            </label>
                            <input type="text" id="structure" name="structure" placeholder="verse, chorus, verse, chorus, bridge, chorus">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Quick Presets</label>
                    <div class="presets-container">
                        <div class="preset-btn" data-preset="pop">Pop Hit</div>
                        <div class="preset-btn" data-preset="ballad">Power Ballad</div>
                        <div class="preset-btn" data-preset="rap">Rap Song</div>
                        <div class="preset-btn" data-preset="rock">Rock Anthem</div>
                        <div class="preset-btn" data-preset="random">Surprise Me</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rhyme-scheme">Rhyme Scheme (optional)
                        <span class="tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Leave blank for automatic rhyme scheme</span>
                        </span>
                    </label>
                    <input type="text" id="rhyme-scheme" name="rhyme-scheme" placeholder="e.g. AABB or ABAB">
                </div>
                
                <div class="form-group">
                    <label>
                        Advanced Options
                        <span class="toggle-switch">
                            <input type="checkbox" id="advanced-toggle">
                            <span class="toggle-slider"></span>
                        </span>
                    </label>
                    
                    <div id="advanced-options" style="display: none; margin-top: 15px;">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="length">Length
                                    <span class="slider-value" id="length-value">Medium</span>
                                </label>
                                <input type="range" min="1" max="3" value="2" class="slider" id="length">
                            </div>
                            <div class="form-col">
                                <label for="complexity">Complexity
                                    <span class="slider-value" id="complexity-value">Balanced</span>
                                </label>
                                <input type="range" min="1" max="3" value="2" class="slider" id="complexity">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Keywords (optional)</label>
                            <div id="keyword-container">
                                <input type="text" id="keyword-input" placeholder="Add keywords to include" style="margin-bottom: 10px;">
                                <div id="keywords-display"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="generate-lyrics-btn">
                    <span id="lyrics-btn-text"><i class="fas fa-magic"></i> Generate Lyrics</span>
                </button>
            </form>
            
            <div class="status" id="lyrics-status"></div>
            
            <div class="result-container" id="lyrics-result-container">
                <h3 class="result-title"><i class="fas fa-file-alt"></i> Generated Lyrics</h3>
                <div class="lyrics-result" id="lyrics-result"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="copy-lyrics-btn">
                        <i class="fas fa-copy"></i> Copy Lyrics
                    </button>
                    <button class="btn btn-secondary" id="use-for-music-btn">
                        <i class="fas fa-music"></i> Use for Music Generation
                    </button>
                    <button class="btn btn-info" id="refine-lyrics-btn">
                        <i class="fas fa-wand-magic-sparkles"></i> Enhance with AI
                    </button>
                </div>
            </div>

            <div class="result-container" id="refined-lyrics-container" style="display: none;">
                <h3 class="result-title"><i class="fas fa-sparkles"></i> Refined Lyrics <span class="ai-badge">AI Enhanced</span></h3>
                <div class="lyrics-result" id="refined-lyrics-result"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" id="copy-refined-lyrics-btn">
                        <i class="fas fa-copy"></i> Copy Refined Lyrics
                    </button>
                    <button class="btn btn-success" id="use-refined-for-music-btn">
                        <i class="fas fa-music"></i> Use for Music Generation
                    </button>
                    <button class="btn btn-warning" id="compare-lyrics-btn">
                        <i class="fas fa-columns"></i> Compare Versions
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Music Generator Section -->
        <section class="generator-section">
            <h2 class="section-title">AI Music Generator</h2>
            
            <form id="music-generator-form">
                <div class="form-group">
                    <label for="lyrics">Lyrics</label>
                    <textarea id="lyrics" name="lyrics" placeholder="Enter your lyrics with section markers like [VERSE], [CHORUS], etc." required></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" id="generate-music-btn">
                    <span id="music-btn-text">Generate Music</span>
                </button>
            </form>
            
            <div class="status" id="music-status"></div>
            
            <div class="result-container" id="music-result-container">
                <h3 class="result-title"><i class="fas fa-headphones"></i> Generated Music</h3>
                
                <div class="waveform" id="waveform"></div>
                
                <audio controls class="audio-player" id="audio-player"></audio>
                
                <div class="action-buttons">
                    <a class="btn btn-success" id="download-music-btn">
                        <i class="fas fa-download"></i> Download Music
                    </a>
                    <button class="btn btn-secondary" id="new-music-btn">
                        <i class="fas fa-redo"></i> Generate New
                    </button>
                    <button class="btn btn-info" id="remix-btn">
                        <i class="fas fa-random"></i> Remix Version
                    </button>
                    <button class="btn btn-warning" id="save-project-btn">
                        <i class="fas fa-save"></i> Save Project
                    </button>
                </div>
            </div>

        </section>


        <section class="generator-section">
            <h2 class="section-title"><i class="fas fa-lightbulb"></i> Songwriting Tips</h2>
            <div class="lyrics-result">
                <h4 style="margin-bottom: 15px; color: var(--accent);">Getting the Best Results</h4>
                <ul style="padding-left: 20px; line-height: 1.8;">
                    <li>Use clear section markers like [VERSE], [CHORUS], [BRIDGE] in your lyrics</li>
                    <li>For more emotional lyrics, provide specific details rather than abstract concepts</li>
                    <li>Try different genres and structures to find unique combinations</li>
                    <li>Use the "Enhance with AI" feature to polish your generated lyrics</li>
                    <li>Experiment with different vocal styles and tempos in the music generator</li>
                </ul>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if models are initialized

            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-theme');
                const icon = this.querySelector('.theme-icon');
                const text = this.querySelector('span');
                
                if (document.body.classList.contains('light-theme')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    text.textContent = 'Light';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    text.textContent = 'Dark';
                }
            });

            // Advanced options toggle
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedOptions = document.getElementById('advanced-options');
            
            advancedToggle.addEventListener('change', function() {
                if (this.checked) {
                    advancedOptions.style.display = 'block';
                } else {
                    advancedOptions.style.display = 'none';
                }
            });
            
            // Slider value displays
            const lengthSlider = document.getElementById('length');
            const lengthValue = document.getElementById('length-value');
            const lengthTexts = ['Short', 'Medium', 'Long'];
            
            lengthSlider.addEventListener('input', function() {
                lengthValue.textContent = lengthTexts[this.value - 1];
            });

            const complexitySlider = document.getElementById('complexity');
            const complexityValue = document.getElementById('complexity-value');
            const complexityTexts = ['Simple', 'Balanced', 'Complex'];
            
            complexitySlider.addEventListener('input', function() {
                complexityValue.textContent = complexityTexts[this.value - 1];
            });

            // Preset buttons
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const preset = this.dataset.preset;
                    
                    // Reset all presets
                    presetButtons.forEach(btn => btn.style.borderColor = 'rgba(255, 255, 255, 0.2)');
                    
                    // Highlight selected preset
                    this.style.borderColor = 'var(--primary)';
                    
                    // Apply preset settings
                    switch(preset) {
                        case 'pop':
                            document.getElementById('genre').value = 'pop';
                            document.getElementById('emotion').value = 'happy';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, bridge, chorus';
                            break;
                        case 'ballad':
                            document.getElementById('genre').value = 'pop';
                            document.getElementById('emotion').value = 'emotional';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, bridge, chorus';
                            break;
                        case 'rap':
                            document.getElementById('genre').value = 'hiphop';
                            document.getElementById('emotion').value = 'energetic';
                            document.getElementById('structure').value = 'verse, verse, chorus, verse, verse, chorus';
                            break;
                        case 'rock':
                            document.getElementById('genre').value = 'rock';
                            document.getElementById('emotion').value = 'angry';
                            document.getElementById('structure').value = 'verse, chorus, verse, chorus, solo, chorus';
                            break;
                        case 'random':
                            // Randomize settings
                            const genres = ['pop', 'rock', 'hiphop', 'rnb', 'country', 'electronic', 'jazz', 'indie'];
                            const emotions = ['happy', 'sad', 'emotional', 'energetic', 'romantic', 'relaxed', 'angry', 'nostalgic'];
                            const structures = [
                                'verse, chorus, verse, chorus, bridge, chorus',
                                'verse, pre-chorus, chorus, verse, pre-chorus, chorus, bridge, chorus',
                                'intro, verse, chorus, verse, chorus, outro',
                                'verse, verse, chorus, verse, chorus',
                                'chorus, verse, chorus, verse, chorus'
                            ];
                            
                            document.getElementById('genre').value = genres[Math.floor(Math.random() * genres.length)];
                            document.getElementById('emotion').value = emotions[Math.floor(Math.random() * emotions.length)];
                            document.getElementById('structure').value = structures[Math.floor(Math.random() * structures.length)];
                            break;
                    }
                });
            });

            // Audio visualizer
            function createWaveform() {
                const waveform = document.getElementById('waveform');
                waveform.innerHTML = '';
                
                for (let i = 0; i < 100; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'waveform-bar';
                    bar.style.left = `${i}%`;
                    bar.style.height = `${Math.random() * 60 + 20}%`;
                    waveform.appendChild(bar);
                }
            }
            
            createWaveform();

            checkModelsStatus();
            
            // Lyrics Generation Form
            const lyricsForm = document.getElementById('lyrics-generator-form');
            const lyricsResult = document.getElementById('lyrics-result');
            const refinedLyricsResult = document.getElementById('refined-lyrics-result');
            const lyricsResultContainer = document.getElementById('lyrics-result-container');
            const refinedLyricsContainer = document.getElementById('refined-lyrics-container');
            const lyricsStatus = document.getElementById('lyrics-status');
            const generateLyricsBtn = document.getElementById('generate-lyrics-btn');
            const lyricsBtnText = document.getElementById('lyrics-btn-text');
            const refineLyricsBtn = document.getElementById('refine-lyrics-btn');
            const compareLyricsBtn = document.getElementById('compare-lyrics-btn');

            // Modify your existing lyrics form submission handler
            lyricsForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log("Form submitted"); // Debug log
                
                // Reset UI
                lyricsResultContainer.style.display = 'none';
                refinedLyricsContainer.style.display = 'none';
                lyricsStatus.style.display = 'none';
                
                // Show loading state
                generateLyricsBtn.disabled = true;
                lyricsBtnText.innerHTML = '<span class="spinner"></span> Generating...';
                console.log("UI reset and loading state shown"); // Debug log
                
                try {
                    console.log("Making API request..."); // Debug log
                    const response = await fetch('/generate_lyrics', {
                        method: 'POST',
                        body: new FormData(lyricsForm),

                    });
                    
                    console.log("Response received:", response); // Debug log
                    const data = await response.json();
                    console.log("Response data:", data); // Debug log
                    
                    if (data.success) {
                        console.log("Success - displaying lyrics"); // Debug log
                        lyricsResult.textContent = data.initial_lyrics;
                        refinedLyricsResult.textContent = data.refined_lyrics;
                        
                        lyricsResultContainer.style.display = 'block';
                        refinedLyricsContainer.style.display = 'block';
                        
                        lyricsStatus.textContent = 'Lyrics generated and enhanced with AI!';
                        lyricsStatus.className = 'status status-success';
                        lyricsStatus.style.display = 'block';
                    } else {
                        console.log("Error from server:", data.error); // Debug log
                        lyricsStatus.textContent = data.error || 'Error generating lyrics';
                        lyricsStatus.className = 'status status-error';
                        lyricsStatus.style.display = 'block';
                    }
                } catch (error) {
                    console.error("Fetch error:", error); // Debug log
                    lyricsStatus.textContent = 'Error connecting to server';
                    lyricsStatus.className = 'status status-error';
                    lyricsStatus.style.display = 'block';
                } finally {
                    generateLyricsBtn.disabled = false;
                    lyricsBtnText.innerHTML = '<i class="fas fa-magic"></i> Generate Lyrics';
                    console.log("Request completed"); // Debug log
                }
            });

            // Function to display lyrics with section formatting
            function displayLyrics(lyrics, element) {
                // Split lyrics into sections
                const sections = lyrics.split(/(\[[A-Z]+\])/g);
                let html = '';
                
                for (let i = 0; i < sections.length; i++) {
                    const section = sections[i].trim();
                    if (!section) continue;
                    
                    if (section.startsWith('[') && section.endsWith(']')) {
                        // It's a section header
                        html += `<div class="lyrics-section"><span class="section-label">${section}</span>`;
                    } else {
                        // It's the content of a section
                        const lines = section.split('\n').filter(line => line.trim() !== '');
                        lines.forEach(line => {
                            html += `<div class="lyrics-line">${line}</div>`;
                        });
                        html += '</div>';
                    }
                }
                
                element.innerHTML = html;
                element.classList.add('animate-in');
            }

            // Compare lyrics button
            compareLyricsBtn.addEventListener('click', function() {
                // Create a comparison view
                const comparisonHTML = `
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;">Original Version</h4>
                            ${lyricsResult.innerHTML}
                        </div>
                        <div style="flex: 1;">
                            <h4 style="color: var(--accent); margin-bottom: 10px;">Enhanced Version</h4>
                            ${refinedLyricsResult.innerHTML}
                        </div>
                    </div>
                `;
                
                // Replace content with comparison
                refinedLyricsResult.innerHTML = comparisonHTML;
            });

            // Copy lyrics button
            document.getElementById('copy-lyrics-btn').addEventListener('click', function() {
                navigator.clipboard.writeText(lyricsResult.textContent).then(() => {
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                });
            });
                        // Copy refined lyrics button
            document.getElementById('copy-refined-lyrics-btn').addEventListener('click', function() {
                navigator.clipboard.writeText(refinedLyricsResult.textContent).then(() => {
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Refined lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                });
            });

            // Use lyrics for music generation button
            document.getElementById('use-for-music-btn').addEventListener('click', function() {
                document.getElementById('lyrics').value = lyricsResult.textContent;
                
                // Scroll to music generator section
                document.querySelector('#music-generator-form').scrollIntoView({
                    behavior: 'smooth'
                });
            });
            
            // Add these event listeners after your existing code
            document.getElementById('copy-refined-lyrics-btn').addEventListener('click', function() {
                // Get the refined lyrics text
                const refinedLyrics = document.getElementById('refined-lyrics-result').textContent;
                
                // Copy to clipboard
                navigator.clipboard.writeText(refinedLyrics).then(() => {
                    // Show success message
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Refined lyrics copied to clipboard!';
                    status.className = 'status status-success';
                    status.style.display = 'block';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        status.style.display = 'none';
                    }, 3000);
                }).catch(err => {
                    console.error('Failed to copy lyrics: ', err);
                    const status = document.getElementById('lyrics-status');
                    status.textContent = 'Failed to copy lyrics';
                    status.className = 'status status-error';
                    status.style.display = 'block';
                });
            });

            document.getElementById('use-refined-for-music-btn').addEventListener('click', function() {
                // Get the refined lyrics text
                const refinedLyrics = document.getElementById('refined-lyrics-result').textContent;
                
                // Set the lyrics in the music generator textarea
                document.getElementById('lyrics').value = refinedLyrics;
                
                // Scroll to the music generator section smoothly
                document.querySelector('#music-generator-form').scrollIntoView({
                    behavior: 'smooth'
                });
                
                // Show success message
                const status = document.getElementById('lyrics-status');
                status.textContent = 'Refined lyrics loaded into music generator!';
                status.className = 'status status-success';
                status.style.display = 'block';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            });

            // Music Generation Form
            const musicForm = document.getElementById('music-generator-form');
            const musicResultContainer = document.getElementById('music-result-container');
            const audioPlayer = document.getElementById('audio-player');
            const musicStatus = document.getElementById('music-status');
            const generateMusicBtn = document.getElementById('generate-music-btn');
            const musicBtnText = document.getElementById('music-btn-text');
            const downloadMusicBtn = document.getElementById('download-music-btn');
            const newMusicBtn = document.getElementById('new-music-btn');
            
            let musicJobId = null;
            let statusCheckInterval = null;
            
            musicForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Reset UI
                musicResultContainer.style.display = 'none';
                musicStatus.style.display = 'none';
                
                // Show loading state
                generateMusicBtn.disabled = true;
                musicBtnText.innerHTML = '<span class="spinner"></span> Generating...';
                
                // Get form data
                const formData = new FormData(musicForm);
                
                try {
                    // Send request to server
                    const response = await fetch('/generate_music', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Store job ID
                    musicJobId = data.job_id;
                    
                    // Show processing status
                    musicStatus.innerHTML = `
                        <div>Processing your music... This may take a minute.</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="music-progress-bar"></div>
                        </div>
                    `;
                    musicStatus.className = 'status status-processing';
                    musicStatus.style.display = 'block';
                    
                    // Start checking status
                    startMusicStatusCheck();
                } catch (error) {
                    musicStatus.textContent = error.message || 'Error starting music generation';
                    musicStatus.className = 'status status-error';
                    musicStatus.style.display = 'block';
                    
                    // Reset button state
                    generateMusicBtn.disabled = false;
                    musicBtnText.textContent = 'Generate Music';
                }
            });
            
            // Save project button
            document.getElementById('save-project-btn').addEventListener('click', function() {
                const lyrics = document.getElementById('lyrics').value;
                const musicUrl = audioPlayer.src;
                
                if (!lyrics.trim() || !musicUrl) {
                    musicStatus.textContent = 'Nothing to save - generate music first';
                    musicStatus.className = 'status status-error';
                    musicStatus.style.display = 'block';
                    return;
                }
                
                // Create a blob with project data
                const projectData = {
                    lyrics: lyrics,
                    musicUrl: musicUrl,
                    settings: {
                        genre: document.getElementById('music-genre').value,
                        vocalStyle: document.getElementById('vocal-style').value,
                        tempo: tempoSlider.value,
                        intensity: intensitySlider.value,
                        instruments: Array.from(document.querySelectorAll('#instrument-tags .tag.active:not([data-instrument="all"])'))
                            .map(tag => tag.dataset.instrument)
                    },
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create download link
                const a = document.createElement('a');
                a.href = url;
                a.download = `music_project_${new Date().getTime()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Show success message
                musicStatus.textContent = 'Project saved successfully!';
                musicStatus.className = 'status status-success';
                musicStatus.style.display = 'block';
            });
            
            function startMusicStatusCheck() {
                if (statusCheckInterval) {
                    clearInterval(statusCheckInterval);
                }
                
                statusCheckInterval = setInterval(async () => {
                    if (!musicJobId) {
                        clearInterval(statusCheckInterval);
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/music_status/${musicJobId}`);
                        const data = await response.json();
                        
                        // Update progress
                        const progressBar = document.getElementById('music-progress-bar');
                        if (progressBar) {
                            progressBar.style.width = `${data.progress}%`;
                        }
                        
                        if (data.status === 'completed') {
                            // Generation complete
                            clearInterval(statusCheckInterval);
                            
                            // Set audio source
                            audioPlayer.src = data.download_url;
                            
                            // Set download link
                            downloadMusicBtn.href = data.download_url;
                            downloadMusicBtn.download = `generated_music_${musicJobId}.wav`;
                            
                            // Show results
                            musicResultContainer.style.display = 'block';
                            
                            // Update status
                            musicStatus.textContent = 'Music generated successfully!';
                            musicStatus.className = 'status status-success';
                            
                            // Reset button state
                            generateMusicBtn.disabled = false;
                            musicBtnText.textContent = 'Generate Music';
                        } else if (data.status === 'failed') {
                            // Generation failed
                            clearInterval(statusCheckInterval);
                            
                            musicStatus.textContent = data.error || 'Music generation failed';
                            musicStatus.className = 'status status-error';
                            
                            // Reset button state
                            generateMusicBtn.disabled = false;
                            musicBtnText.textContent = 'Generate Music';
                        }
                    } catch (error) {
                        console.error('Error checking status:', error);
                    }
                }, 2000); // Check every 2 seconds
            }
            
            // New music button
            newMusicBtn.addEventListener('click', function() {
                musicForm.reset();
                musicResultContainer.style.display = 'none';
                musicStatus.style.display = 'none';
            });
            
            // Check if models are initialized
            async function checkModelsStatus() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    
                    if (!data.lyrics_model_initialized) {
                        showAlert('Lyrics model not initialized. Some features may not work.', 'error');
                    }
                    
                    if (!data.music_generation_ready) {
                        showAlert('Music generation not ready. Some features may not work.', 'error');
                    }
                    
                    // Populate emotions if available
                    if (data.emotions && data.emotions.length > 0) {
                        const emotionSelect = document.getElementById('emotion');
                        emotionSelect.innerHTML = '';
                        
                        data.emotions.forEach(emotion => {
                            const option = document.createElement('option');
                            option.value = emotion;
                            option.textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
                            emotionSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error checking models status:', error);
                }
            }
            
            function showAlert(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `status status-${type}`;
                alertDiv.textContent = message;
                alertDiv.style.marginTop = '20px';
                document.querySelector('main').prepend(alertDiv);
                
                // Remove after 5 seconds
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        });
    </script>
</body>
</html>